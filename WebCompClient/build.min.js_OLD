"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(l,a){function s(e){try{c(o.next(e))}catch(e){a(e)}}function r(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?l(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,r)}c((o=o.apply(e,t||[])).next())})};define("WebComponents/BaseComponent",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class n extends HTMLElement{constructor(e){super(),this._shadRoot=null,n.urlChangedEventAdded||(console.log("Added global event handler for events 'locationchange', 'popstate', 'pushstate' to window object"),window.addEventListener("locationchange",this.onUrlChanged.bind(this)),window.addEventListener("popstate",this.onPopstate.bind(this)),window.addEventListener("pushstate",this.onPushstate.bind(this)),n.urlChangedEventAdded=!0),console.log(`${this.constructor.name} ctor() called`);let t={htmlElement:"main",instance:this,url:"home"};if(console.log(`Looking for existing html component ${e}`),null!=n._components.get(e)){let t=`Html component ${e} already exists, aborting ctor`;return alert(t),void console.log(t)}console.log(`Html component ${e} not found, adding to hash map`),n._components.set(e,t),this.TagName=e,this.cloneAndAttachTemplate(!1)}get TagName(){return this.constructor._tagName}set TagName(e){this.constructor._tagName=e}get TemplateHtml(){return this.constructor._templateHtml}set TemplateHtml(e){this.constructor._templateHtml=e}get ShadRoot(){return this._shadRoot}set ShadRoot(e){this._shadRoot=e}GetShadowElement(e){let t=this.shadowRoot;if(null==t)return alert("GetShadowElement(): this.shadowRoot is null"),null;let n=t.querySelector(`#${e}`);return null==n?(alert(`GetShadowElement(): element with id ${e} not found`),null):n}SetElementContent(e){let t=`wcf-${e}`,n=String(this[e]),o=this.GetShadowElement(t);null!=o&&(o.innerHTML=n)}connectedCallback(){return __awaiter(this,void 0,void 0,function*(){console.log(`super: ${this.constructor.name}.connectedCallback() called`),null==this.ShadRoot?customElements.whenDefined(this.TagName)?(console.log(`Component ${this.TagName} NOT initialised, awaiting html template load...`),yield this.loadTemplate()):alert(`${this.TagName} is not [yet?] registered, have you called customElements.define('${this.TagName}', '${this.constructor.name}')`):console.log(`Component ${this.TagName} is already initialised, exiting connectedCallback`)})}disconnectedCallback(){return __awaiter(this,void 0,void 0,function*(){console.log(`${this.constructor.name}.disconnectedCallback() called`)})}adoptedCallback(){return __awaiter(this,void 0,void 0,function*(){alert(`${this.constructor.name}.adoptedCallback() called`)})}AddEventHandler(e,t,n){let o=new Function("ev",n),l=this.GetShadowElement(e);null!=l&&l.addEventListener(t,o.bind(this))}ParseEvent(e){let t=0,n=e.indexOf("id=")+4;-1!=n&&(t=e.indexOf('"',n));let o=e.indexOf("@")+1,l=e.indexOf('"',o)-1,a=l+2,s=e.indexOf('"',a),r=e.substring(n,t),c=e.substring(o,l),i=e.substring(a,s);this.AddEventHandler(r,c,i)}ParseAndAttachEvents(e){e.replace(/<.+@.+>/gm,e=>(this.ParseEvent(e),""))}GetPropValue(e){let t=e;return t in this||alert(`HTML Template Error: Property/field '${t}' does not exist in component ${this.constructor.name}`),this[t]}AddDataBinding(e){let t=e.replace(/{{\w+}}/gm,e=>{let t=e.substring(2,e.length-2);return`<span id="wcf-${t}">${this.GetPropValue(t)}</span>`});return t=t.replace(/\[\[\w+\]\]/gm,e=>{let t=e.substring(2,e.length-2);return`${this.GetPropValue(t)}`}),console.log(t),t}loadTemplate(){return __awaiter(this,void 0,void 0,function*(){let e=`/WebComponents/${this.TagName}/${this.TagName}.html`;e=e.replace(/-/gm,"");let t=yield fetch(e);if(null==t)return void alert(`Cannot load template with id ${this.TagName} in ${e}`);let n=yield t.text();this.TemplateHtml=this.AddDataBinding(n);let o=document.querySelector("head");null!=o?(o.insertAdjacentHTML("beforeend",this.TemplateHtml),this.cloneAndAttachTemplate(!0)):alert("<head> element not found in doc, aborting")})}cloneAndAttachTemplate(e){const t=`#${this.TagName}`,n=document.querySelector(t);if(null==n){let n=`Cannot find template with id ${t} in current html document`;return void(e?alert("ERROR:"+n):console.log("Deferring component creation to connectedCallback(): "+n))}const o=n.content;this.ShadRoot=this.attachShadow({mode:"open"}),this.ShadRoot.appendChild(o.cloneNode(!0)),console.log(`HTML template has been attached for ${this.TagName}`),this.ParseAndAttachEvents(n.innerHTML)}loadComponent(e,t,o,l=!0){let a;console.log(`Attempting to load component ${e} into element <${t}> and then set url to /${o}`);let s=n._components.get(e);if(null==s){let t=window.customElements.get(e);if(void 0===t){let t=`Component '${e}' not found. Check component is registered with customElements.define(...) in app.ts`;return console.log(t),void alert(t)}console.log(`Creating new component '${t.constructor.name}'`),a=new t(e)}else console.log(`Found existing component ${e}`),a=s.instance;let r=document.querySelector(t);if(null==r)return void alert(`Could not find element ${t} in current document`);let c=r.firstChild;if(null!=c){if(r.replaceChild(a,c),l){let n={htmlTag:e,targetElement:t,url:o};console.log(`Calling history.pushstate(${JSON.stringify(n)})`),history.pushState(n,"title",`/${o}`)}}else alert(`Element ${t} has no child element to replace`)}onPopstate(e){let t=e.state;null!=t?(console.log(`Popstate event fired: ${JSON.stringify(t)}`),this.loadComponent(t.htmlTag,t.targetElement,t.url,!1)):console.log("onPopstate(), pushstate is null")}onUrlChanged(e){alert("url changed"),console.log(e)}onPushstate(e){alert("pushstate changed"),console.log(e)}}t.default=n,n.urlChangedEventAdded=!1,n._components=new Map,n._tagName="not used",n._templateHtml="not used"}),define("WebComponents/MyHeader/MyHeader",["require","exports","WebComponents/BaseComponent"],function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});t.default=class extends n.default{constructor(){super("my-header")}}}),define("WebComponents/MyFooter/MyFooter",["require","exports","WebComponents/BaseComponent"],function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});t.default=class extends n.default{constructor(){super("my-footer"),this.copyright=`(c) Widget Ltd ${(new Date).getFullYear()}`}}}),define("WebComponents/MyAside/MyAside",["require","exports","WebComponents/BaseComponent"],function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});t.default=class extends n.default{constructor(){super("my-aside")}}}),define("WebComponents/MyContent/MyContent",["require","exports","WebComponents/BaseComponent"],function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});t.default=class extends n.default{constructor(){super("my-content"),this._a=1,this._b=2}get a(){return this._a}set a(e){this._a=Number(e),super.SetElementContent("a"),super.SetElementContent("total")}get b(){return this._b}set b(e){this._b=Number(e),super.SetElementContent("b"),super.SetElementContent("total")}get total(){return this.a+this.b}connectedCallback(){const e=Object.create(null,{connectedCallback:{get:()=>super.connectedCallback}});return __awaiter(this,void 0,void 0,function*(){console.log("sub: MyContent.connectedCallback() called"),yield e.connectedCallback.call(this),console.log("sub: MyContent.connectedCallback() base class completed (allegedly)")})}increaseA(e){console.log(`increaseA: ${e}`)}increaseB(e){console.log(`increaseA: ${e}`)}}}),define("WebComponents/HtmlPage/HtmlPage",["require","exports","WebComponents/BaseComponent"],function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});t.default=class extends n.default{constructor(){super("html-page"),this.pageName="",this.pageContent=""}connectedCallback(){const e=Object.create(null,{connectedCallback:{get:()=>super.connectedCallback}});return __awaiter(this,void 0,void 0,function*(){console.log("sub: HtmlPage.connectedCallback() called"),yield e.connectedCallback.call(this);let t=window.location.href,n=t.lastIndexOf("/");this.pageName=t.substr(n+1);let o=yield fetch(`/WebComponents/TestData/${this.pageName}.html`);this.pageContent=yield o.text(),this.SetElementContent("pageName"),this.SetElementContent("pageContent"),console.log("sub: HtmlPage.connectedCallback() base class completed")})}}}),define("WebComponents/MyCounter/MyCounter",["require","exports","WebComponents/BaseComponent"],function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});t.default=class extends n.default{constructor(){super("my-counter"),this._count=1}get count(){return this._count}set count(e){this._count=e,super.SetElementContent("count")}connectedCallback(){const e=Object.create(null,{connectedCallback:{get:()=>super.connectedCallback}});return __awaiter(this,void 0,void 0,function*(){yield e.connectedCallback.call(this)})}}}),define("WebComponents/MyInputForm/Person",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.forename="John",this.surname="Smith",this.dob=new Date,this.age=55,this.alive=!0}}}),define("WebComponents/MyInputForm/MyInputForm",["require","exports","WebComponents/BaseComponent","WebComponents/MyInputForm/Person"],function(e,t,n,o){Object.defineProperty(t,"__esModule",{value:!0});t.default=class extends n.default{constructor(e){super("my-input-form"),this.dto=e,console.log("MyInputForm ctor(...) called"),console.log(`dto = ${e}`)}connectedCallback(){const e=Object.create(null,{connectedCallback:{get:()=>super.connectedCallback}});return __awaiter(this,void 0,void 0,function*(){yield e.connectedCallback.call(this),console.log("MyInputForm.connectedCallback() called"),this.dto=new o.default,this.dto.forename="John",this.dto.surname="Smith",this.dto.dob=new Date("1995-12-31T23:59:59"),this.dto.age=88,this.dto.alive=!0,this.copyDtoToFormA(this.dto)})}onSubmit(){console.log("MyInputForm.onSubmit() called");let e=new o.default;this.dto=this.copyFormToDtoA(e),console.log(this.dto)}convertStringToType(e,t){const n="convertStringToType(): Hit default in switch (Unknown property type)";switch(typeof e){case"string":return t;case"number":return Number(t);case"boolean":return Boolean(t);case"object":return e instanceof Date?new Date(t):(alert(n),n);default:return alert(n),n}}createDto(e){return[new e,new e]}copyFormToDtoA(e){const t=Reflect.ownKeys(e);for(const n of t){let t=`wci-${n}`,o=this.GetShadowElement(t);if(null==o){alert(`Input element ${o} not found in input form`);continue}let l=e[n],a=typeof l;switch(typeof e[n]){case"string":e[n]=o.value;break;case"number":e[n]=o.valueAsNumber;break;case"object":l instanceof Date?e[n]=o.valueAsDate:alert("copyDtoToFormA() - non-Date object encountered");break;case"boolean":e[n]=o.checked;break;default:alert(`copyDtoToFormA() - hit default in switch, type was '${a}'`)}}return e}copyDtoToFormA(e){const t=Reflect.ownKeys(e);for(const n of t){let t=`wci-${n}`,o=this.GetShadowElement(t);if(null==o){alert(`Input element ${o} not found in input form`);continue}let l=e[n],a=typeof l;switch(typeof l){case"string":o.value=l;break;case"number":o.valueAsNumber=l;break;case"object":l instanceof Date?o.valueAsDate=l:alert("copyDtoToFormA() - non-Date object encountered");break;case"boolean":o.checked=l;break;default:alert(`copyDtoToFormA() - hit default in switch, type was '${a}'`)}}}}}),define("app",["require","exports","WebComponents/MyHeader/MyHeader","WebComponents/MyFooter/MyFooter","WebComponents/MyAside/MyAside","WebComponents/MyContent/MyContent","WebComponents/HtmlPage/HtmlPage","WebComponents/MyCounter/MyCounter","WebComponents/MyInputForm/MyInputForm"],function(e,t,n,o,l,a,s,r,c){Object.defineProperty(t,"__esModule",{value:!0}),customElements.define("my-header",n.default),customElements.define("my-footer",o.default),customElements.define("my-aside",l.default),customElements.define("my-content",a.default),customElements.define("html-page",s.default),customElements.define("my-counter",r.default),customElements.define("my-input-form",c.default)});